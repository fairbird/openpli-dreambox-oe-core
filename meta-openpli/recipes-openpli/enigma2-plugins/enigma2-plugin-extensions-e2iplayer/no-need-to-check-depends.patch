From 60c650333ef8df54e0c2018e5c42bc3330dba543 Mon Sep 17 00:00:00 2001
From: fairbird <rrrr53@hotmail.com>
Date: Tue, 21 May 2024 16:49:58 +0300
Subject: [PATCH] no-need-to-check-depends

---
 IPTVPlayer/components/iptvconfigmenu.py     | 15 +++++++--------
 IPTVPlayer/components/iptvextmovieplayer.py |  2 +-
 IPTVPlayer/components/iptvplayerwidget.py   |  9 ++++-----
 IPTVPlayer/plugin.py                        |  2 ++
 IPTVPlayer/tools/e2ijs.py                   |  2 +-
 5 files changed, 15 insertions(+), 15 deletions(-)

diff --git a/IPTVPlayer/components/iptvconfigmenu.py b/IPTVPlayer/components/iptvconfigmenu.py
index b42045d..199cb68 100755
--- a/IPTVPlayer/components/iptvconfigmenu.py
+++ b/IPTVPlayer/components/iptvconfigmenu.py
@@ -224,7 +224,7 @@ config.plugins.iptvplayer.myjd_password = ConfigText(default="", fixed_size=Fals
 config.plugins.iptvplayer.myjd_jdname = ConfigText(default="", fixed_size=False)
 
 # Update
-config.plugins.iptvplayer.autoCheckForUpdate = ConfigYesNo(default=True)
+config.plugins.iptvplayer.autoCheckForUpdate = ConfigYesNo(default=False)
 config.plugins.iptvplayer.updateLastCheckedVersion = ConfigText(default="00.00.00.00", fixed_size=False)
 config.plugins.iptvplayer.fakeUpdate = ConfigSelection(default="fake", choices=[("fake", "  ")])
 config.plugins.iptvplayer.downgradePossible = ConfigYesNo(default=False)
@@ -370,7 +370,6 @@ class ConfigMenu(ConfigBaseWidget):
 
         list.append(getConfigListEntry('\\c00289496' + _("----- BASIC CONFIGURATION (OK) -----"), config.plugins.iptvplayer.basicConfVisible))
         if basicConfVisible: #BASIC CONFIGURATION
-            list.append(getConfigListEntry(_("Auto check for plugin update"), config.plugins.iptvplayer.autoCheckForUpdate))
             list.append(getConfigListEntry(_("The preferred update server"), config.plugins.iptvplayer.preferredupdateserver))
             if config.plugins.iptvplayer.preferredupdateserver.value == '2':
                 list.append(getConfigListEntry(_("Add update from GitLab repository"), config.plugins.iptvplayer.gitlab_repo))
@@ -604,7 +603,7 @@ class ConfigMenu(ConfigBaseWidget):
         if config.plugins.iptvplayer.preferredupdateserver.value == "4": #opkg
             return ''
         elif afterSave and config.plugins.iptvplayer.ListaGraficzna.value and 0 == GetAvailableIconSize(False):
-            needPluginUpdate = True
+            needPluginUpdate = False
         else:
             enabledHostsList = GetEnabledHostsList()
             hostsFromFolder = GetHostsList(fromList=False, fromHostFolder=True)
@@ -616,23 +615,23 @@ class ConfigMenu(ConfigBaseWidget):
                         else:
                             # there is host file which is not enabled,
                             # so we need perform update to remove it
-                            needPluginUpdate = True
+                            needPluginUpdate = False
                             break
                 else:
                     hostsFromList = GetHostsList(fromList=True, fromHostFolder=False)
                     if not set(hostsFromList).issubset(set(hostsFromFolder)):
                         # there is missing hosts files, we need updated does not matter
                         # if these hosts are enabled or disabled
-                        needPluginUpdate = True
+                        needPluginUpdate = False
             elif IsUpdateNeededForHostsChangesCommit(self.enabledHostsListOld, enabledHostsList, hostsFromFolder):
-                needPluginUpdate = True
+                needPluginUpdate = False
 
         if needPluginUpdate:
             SetGraphicsHash("")
             SetIconsHash("")
 
         if not needPluginUpdate and config.plugins.iptvplayer.IPTVWebIterface.value != IsWebInterfaceModuleAvailable(True):
-            needPluginUpdate = True
+            needPluginUpdate = False
 
         if needPluginUpdate:
             return _('Some changes will be applied only after plugin update.\nDo you want to perform update now?')
@@ -648,7 +647,7 @@ class ConfigMenu(ConfigBaseWidget):
 
     def closeAfterMessage(self, arg=None):
         if arg:
-            self.doUpdate(True)
+            self.close()
         else:
             self.close()
 
diff --git a/IPTVPlayer/components/iptvextmovieplayer.py b/IPTVPlayer/components/iptvextmovieplayer.py
index 53c673a..d9a28c3 100755
--- a/IPTVPlayer/components/iptvextmovieplayer.py
+++ b/IPTVPlayer/components/iptvextmovieplayer.py
@@ -2023,8 +2023,7 @@ class IPTVExtMoviePlayer(Screen):
                             cmd += (' "proxy=%s" ' % tmp)
             cmd += " > /dev/null"
         else:
-            exteplayer3path = config.plugins.iptvplayer.exteplayer3path.value
-            cmd = exteplayer3path
+            cmd = '/usr/bin/exteplayer3'
             tmpUri = strwithmeta(self.fileSRC)
 
             audioUri = ''
diff --git a/IPTVPlayer/components/iptvplayerwidget.py b/IPTVPlayer/components/iptvplayerwidget.py
index db5fd96..3a5f080 100755
--- a/IPTVPlayer/components/iptvplayerwidget.py
+++ b/IPTVPlayer/components/iptvplayerwidget.py
@@ -1539,10 +1539,7 @@ class E2iPlayerWidget(Screen):
         self.session.openWithCallback(self.configHostsCallback, ConfigHostsMenu, GetListOfHostsNames())
 
     def configHostsCallback(self, arg1=None):
-        if IsUpdateNeededForHostsChangesCommit(self.enabledHostsListOld):
-            message = _('Some changes will be applied only after plugin update.\nDo you want to perform update now?')
-            self.session.openWithCallback(self.askForUpdateCallback, MessageBox, text=message, type=MessageBox.TYPE_YESNO)
-        elif self.group != None:
+        if self.group != None:
             self.selectHostFromGroup()
         else:
             self.selectHost()
@@ -1553,7 +1550,7 @@ class E2iPlayerWidget(Screen):
     def askForUpdateCallback(self, arg1=None):
         if arg1:
             self.session.openWithCallback(self.selectHost, IPTVUpdateWindow, UpdateMainAppImpl(self.session, allowTheSameVersion=True))
-        elif self.group != None:
+        if self.group != None:
             self.selectHostFromGroup()
         else:
             self.selectHost()
@@ -2123,6 +2120,8 @@ class E2iPlayerWidget(Screen):
             self.requestListFromHost('ForSearch')
 
     def configCallback(self):
+        self.selectHost()
+        return
         if IPTVPlayerNeedInit():
             self.session.openWithCallback(self.selectHost, IPTVSetupMainWidget, True)
         else:
diff --git a/IPTVPlayer/plugin.py b/IPTVPlayer/plugin.py
index 071fe96..ed09b33 100755
--- a/IPTVPlayer/plugin.py
+++ b/IPTVPlayer/plugin.py
@@ -129,6 +129,8 @@ def doRunMain(session):
 
 
 def runMain(session, nextFunction=doRunMain):
+    nextFunction(session)
+    return
     def allToolsFromOPKG():
         if os_exists('/usr/lib/enigma2/python/Plugins/Extensions/IPTVPlayer/plugin.pe2i'):  # users of private version jave all tools installed by design
             return True
diff --git a/IPTVPlayer/tools/e2ijs.py b/IPTVPlayer/tools/e2ijs.py
index 3bbe609..6384b50 100755
--- a/IPTVPlayer/tools/e2ijs.py
+++ b/IPTVPlayer/tools/e2ijs.py
@@ -39,7 +39,7 @@ def duktape_execute(cmd_params):
         noDuk = True
         ret['code'] = 127
 
-    if noDuk:
+    if noDuk and not fileExists("/usr/lib/libduktape.so.207"):
         messages = [_('The duktape utility is necessary here but it was not detected.')]
         messages.append(_('Please consider restart your Engima2 and agree to install the duktape utlity when the E2iPlayer will propose this.'))
         GetIPTVNotify().push('\n'.join(messages), 'error', 40, 'no_duktape', 40)
-- 
2.43.0

